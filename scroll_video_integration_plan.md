# Scroll Video Integration Plan

## Overview
This document outlines the plan to integrate the scroll video output from `archive/create_scroll_video.py` into the final Creatomate video generated by `automated_video_generator.py`. The scroll video will appear at the 3-second mark, overlapping the HeyGen intro + movie1 videos for 2 seconds on track 2.

## Implementation Steps

### 1. Generate the Scroll Video

Add a new function to `automated_video_generator.py` that calls the scroll video generation:

```python
def generate_scroll_video(country, genre, platform, content_type):
    """
    Generate scroll video using the same filter parameters as the main workflow
    
    Returns:
        str: Path to the generated scroll video
    """
    from archive.create_scroll_video import create_scroll_video
    
    logger.info("🖥️ Generating StreamGank scroll video...")
    
    # Define output path
    output_video = "streamgank_scroll_readable.mp4"
    
    # Generate scroll video using same filter parameters as main workflow
    create_scroll_video(
        country=country,
        genre=genre,
        platform=platform,
        content_type=content_type,
        output_video=output_video
    )
    
    # Verify scroll video was created
    if os.path.exists(output_video):
        logger.info(f"✅ Scroll video generated successfully: {output_video}")
        # Upload to Cloudinary
        cloudinary_url = upload_to_cloudinary(output_video, "scroll_video")
        logger.info(f"☁️ Scroll video uploaded to Cloudinary: {cloudinary_url}")
        return cloudinary_url
    else:
        logger.error("❌ Failed to generate scroll video")
        return None
```

### 2. Integrate in Main Workflow

Update the `run_full_workflow` function to generate the scroll video and pass it to the Creatomate function:

```python
# In run_full_workflow function, add before Creatomate creation:
scroll_video_url = None
if not args.skip_scroll_video:
    scroll_video_url = generate_scroll_video(
        country=args.country,
        genre=args.genre,
        platform=args.platform,
        content_type=args.content_type
    )
    logger.info(f"📱 Scroll video URL: {scroll_video_url}")
```

### 3. Modify Creatomate Composition

Update the `create_creatomate_video_from_heygen_urls` function to include the scroll video:

```python
# Update function signature:
def create_creatomate_video_from_heygen_urls(heygen_video_urls: dict, movie_data: List[Dict[str, Any]] = None, scroll_video_url: str = None) -> str:

# In the composition elements, add scroll video element:
# After HeyGen intro + movie1 element (around line 1200)
if scroll_video_url:
    source["elements"].append({
        "fit": "contain",         # Use "contain" to preserve aspect ratio
        "type": "video",
        "track": 2,               # Use track 2 to overlay
        "source": scroll_video_url,
        "time_offset": 3,         # Start at 3-second mark
        "duration": 2,            # Play for 2 seconds
        "width": "50%",           # Size as 50% of screen width
        "x": "75%",               # Position at right side
        "y": "25%",               # Position at top quarter
    })
```

### 4. Add CLI Option

Add a new command line option to skip scroll video generation:

```python
# In parse_arguments function:
parser.add_argument("--skip-scroll-video", action="store_true", help="Skip scroll video generation")
```

### 5. Update Function Call

Update the Creatomate function call in `run_full_workflow`:

```python
# Replace:
creatomate_id = create_creatomate_video_from_heygen_urls(heygen_videos, movie_data)

# With:
creatomate_id = create_creatomate_video_from_heygen_urls(heygen_videos, movie_data, scroll_video_url)
```

## Testing Plan

1. Run the integrated workflow with default parameters
2. Verify the scroll video is generated with the same filter parameters
3. Check the final Creatomate video to ensure the scroll video appears:
   - At the 3-second mark
   - Overlapping HeyGen intro + movie1
   - Playing for 2 seconds on track 2
   - Properly sized and positioned

## Benefits of This Approach

1. **Consistency**: Uses the same filter parameters for both the main workflow and scroll video
2. **Flexibility**: Adds a CLI option to skip scroll video if needed
3. **Clean Integration**: Clearly separates scroll video generation from Creatomate composition
4. **Maintainability**: All related code is added in a modular fashion
